<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{{ data.title }}</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        const data = {{ data|tojson }};
        const relv = {{ relv|tojson }}
        const kpTitle = {{ titledata|tojson }}

    </script>
</head>
<body class="bg-black text-white min-h-screen overflow-x-hidden">

<!-- Orbs -->
<div class="orb a -top-40 -left-40 w-[38rem] h-[38rem]"></div>
<div class="orb b -bottom-40 -right-40 w-[40rem] h-[40rem]"></div>
<div class="orb c top-1/3 left-1/2 -translate-x-1/2 w-[42rem] h-[42rem]"></div>

<!-- Header / Toolbar -->
<header class="p-6 md:p-8">
    <div class="neon rounded-3xl border border-zinc-800 bg-gradient-to-br from-zinc-900/90 to-black/90 p-6 md:p-8 backdrop-blur">
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6">
            <div>
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-zinc-800 bg-zinc-900/70 text-xs text-zinc-300">
                    Live compare • <span class="text-sky-300">OpenAtlas</span> vs <span class="text-amber-300">Kulturpool</span>
                </div>
                <h1 class="text-4xl md:text-6xl mt-3 font-bold leading-tight">{{ data.title }}</h1>
            </div>
            <div class="flex items-center gap-3">
                <span class="px-3 py-1 rounded-full text-xs border border-sky-700/40 bg-sky-500/10 text-sky-300">OpenAtlas</span>
                <span class="px-3 py-1 rounded-full text-xs border border-amber-700/40 bg-amber-500/10 text-amber-300">Kulturpool</span>
                <button style="display:none" id="swapBtn"
                        class="px-3 py-2 text-sm rounded-xl border border-zinc-800 bg-zinc-900/70 hover:bg-zinc-800 transition">
                    Swap sides
                </button>
            </div>
        </div>
    </div>
</header>

<!-- Split container -->
<div id="splitWrap" class="px-6 md:px-8">
    <div class="relative rounded-3xl overflow-hidden border border-zinc-800 bg-zinc-950/60 backdrop-blur-xl">
        <div id="panels" class="grid grid-cols-1 lg:grid-cols-2">

            <!-- LEFT: OpenAtlas -->
            <section id="leftPanel" class="p-6 md:p-8 space-y-8 border-b lg:border-b-0 lg:border-r border-zinc-800">
                <div class="sticky top-2 z-10">
                    <div class="flex items-center justify-between rounded-2xl border border-sky-800/40 bg-sky-900/20 px-4 py-3 backdrop-blur">
                        <div class="flex items-center gap-2">
                            <span class="h-2.5 w-2.5 rounded-full bg-sky-400 animate-pulse"></span>
                            <h2 class="text-2xl font-bold tracking-tight">OpenAtlas</h2>
                        </div>
                        <span class="text-xs px-2 py-1 rounded-full bg-sky-500/15 text-sky-300 border border-sky-700/40">Source</span>
                    </div>
                </div>

                {% if data.files %}
                <div class="neon rounded-3xl bg-zinc-900/80 backdrop-blur border border-zinc-800 p-6 md:p-8">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-3xl text-sky-300">Gallery</h3>
                        <span class="text-[10px] uppercase tracking-wider text-sky-300/70">OpenAtlas</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                        {% for m in data.files %}
                        <figure class="group relative overflow-hidden rounded-2xl border border-zinc-800 bg-zinc-900/40">
                            <img src="{{ m.IIIFBasePath }}/full/full/0/default.jpg" alt="{{ m.title }}"
                                 class="object-cover w-full h-64 md:h-72 transform group-hover:scale-105 transition duration-700">
                            <figcaption class="absolute bottom-0 left-0 w-full bg-black/70 text-white text-sm p-3 opacity-0 group-hover:opacity-100 transition">
                                {{ m.title }}
                            </figcaption>
                            <div class="absolute top-3 left-3 text-[10px] px-2 py-0.5 rounded-full bg-sky-600/20 text-sky-200 border border-sky-700/50">OpenAtlas</div>
                        </figure>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <div class="neon rounded-3xl bg-zinc-900/80 backdrop-blur border border-zinc-800 p-6 md:p-8 tilt">
                    <h3 class="text-3xl mb-4 text-sky-300">Description</h3>
                    <div class="prose prose-invert max-w-none text-lg leading-relaxed">{{ data.description }}</div>
                </div>

                {% if data.relations %}
                <div class="neon rounded-3xl bg-zinc-900/80 backdrop-blur border border-zinc-800 p-6 md:p-8">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-3xl text-sky-300">Relations</h3>
                        <span class="text-[10px] uppercase tracking-wider text-sky-300/70">OpenAtlas</span>
                    </div>
                    {% for type, entities in data.relations.items() %}
                        <p style="margin: 2rem;" class="text-xl font-bold">{{ type }}</p>
                        <div class="grid sm:grid-cols-2 gap-4 md:gap-6">
                            {% for entity in entities %}
                            <div class="bg-zinc-800/70 rounded-2xl p-5 border border-sky-800/30 hover:bg-zinc-800 transition tilt">
                                <p class="uppercase text-xs tracking-wider text-gray-400"><a href="/{{ entity.id }}">{{ entity.title }}</a></p>
                            </div>
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
            </section>

            <!-- RIGHT: Kulturpool -->
            <aside id="rightPanel" class="p-6 md:p-8 space-y-8">
                <div class="sticky top-2 z-10">
                    <div class="flex items-center justify-between rounded-2xl border border-amber-800/40 bg-amber-900/20 px-4 py-3 backdrop-blur">
                        <div class="flex items-center gap-2">
                            <span class="h-2.5 w-2.5 rounded-full bg-amber-400 animate-pulse"></span>
                            <h2 class="text-2xl font-bold tracking-tight">Kulturpool</h2>
                        </div>
                        <span class="text-xs px-2 py-1 rounded-full bg-amber-500/15 text-amber-300 border border-amber-700/40">Source</span>
                    </div>
                </div>

                <!-- Most relevant (show all, no load more) -->
                <div class="neon rounded-3xl bg-zinc-900/80 backdrop-blur border border-zinc-800 p-6 md:p-8">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-2xl text-amber-300">Most relevant</h3>
                        <span class="text-[10px] uppercase tracking-wider text-amber-300/70">Kulturpool</span>
                    </div>
                    <div id="kp-grid-relv" class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6"></div>
                </div>

                <!-- Others (17 initial, +18 per click) -->
                <div class="neon rounded-3xl bg-zinc-900/80 backdrop-blur border border-zinc-800 p-6 md:p-8">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-2xl text-amber-300">Others</h3>
                        <span class="text-[10px] uppercase tracking-wider text-amber-300/70">Kulturpool</span>
                    </div>
                    <div id="kp-grid-others" class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6"></div>
                </div>

                <!-- Attachments -->
                <div class="neon rounded-3xl bg-zinc-900/80 backdrop-blur border border-zinc-800 p-6 md:p-8">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-2xl text-amber-300">Attachments</h4>
                        <span class="text-[10px] uppercase tracking-wider text-amber-300/70">Kulturpool</span>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="h-24 rounded-2xl border border-zinc-800 bg-zinc-900"></div>
                        <div class="h-24 rounded-2xl border border-zinc-800 bg-zinc-900"></div>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Draggable separator -->
        <div id="handle" class="drag-handle" aria-label="Resize panels" role="separator" aria-orientation="vertical">
            <div class="drag-dot">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="opacity-80">
                    <path d="M10 6h4v2h-4V6zm0 10h4v2h-4v-2zm0-5h4v2h-4v-2z"/>
                </svg>
            </div>
        </div>
    </div>
</div>

<footer class="px-6 md:px-8 py-10 text-center text-xs text-zinc-500">OpenAtlas × Kulturpool comparison UI</footer>

<script>
    // Draggable split
    (function () {
        const wrap = document.getElementById('splitWrap');
        const panels = document.getElementById('panels');
        const handle = document.getElementById('handle');
        let x = 50, dragging = false;
        const set = pct => {
            x = Math.min(85, Math.max(15, pct));
            handle.style.setProperty('--x', x + '%');
            panels.style.gridTemplateColumns = x + '% ' + (100 - x) + '%';
        };
        set(x);
        const onMove = e => {
            if (!dragging) return;
            const r = wrap.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const pct = (clientX - r.left) / r.width * 100;
            set(pct);
        };
        const stop = () => dragging = false;
        handle.addEventListener('mousedown', () => dragging = true);
        handle.addEventListener('touchstart', () => dragging = true, {passive:true});
        window.addEventListener('mousemove', onMove);
        window.addEventListener('touchmove', onMove, {passive:false});
        window.addEventListener('mouseup', stop);
        window.addEventListener('touchend', stop);

        // Swap button
        const swapBtn = document.getElementById('swapBtn');
        swapBtn?.addEventListener('click', () => {
            const left = document.getElementById('leftPanel');
            const right = document.getElementById('rightPanel');
            const parent = left.parentNode;
            parent.insertBefore(right, left);
        });
    })();

    // Kulturpool: render all relv; paginate others (17 then +18)
    (function(){
        function normalize(arr){
            if (!Array.isArray(arr)) return [];
            return arr.filter(m => m && (m.previewImage || m.thumbnail) && (m.isShownAt || m.link || m.url));
        }
        const imgUrl  = m => m.previewImage || m.thumbnail;
        const linkUrl = m => m.isShownAt || m.link || m.url || '#';
        const titleOf = m => (m.title || m.name || '').toString();

        function tileFor(m){
            const fig = document.createElement('figure');
            fig.className = "group relative overflow-hidden rounded-2xl border border-zinc-800 bg-zinc-900/40";
            fig.innerHTML = `
              <a href="${linkUrl(m)}" target="_blank" rel="noopener">
                <img src="${imgUrl(m)}" alt="${titleOf(m).replace(/"/g,'&quot;')}" loading="lazy"
                     class="object-cover w-full h-64 md:h-72 transform group-hover:scale-105 transition duration-700">
              </a>
              <figcaption class="absolute bottom-0 left-0 w-full bg-black/70 text-white text-sm p-3 opacity-0 group-hover:opacity-100 transition">
                ${titleOf(m) || '&nbsp;'}
              </figcaption>
              <div class="absolute top-3 left-3 text-[10px] px-2 py-0.5 rounded-full bg-amber-600/20 text-amber-200 border border-amber-700/50">
                Kulturpool
              </div>`;
            return fig;
        }

        // MOST RELEVANT: render all, no button
        (function renderRelv(){
            const grid = document.getElementById('kp-grid-relv');
            if (!grid) return;
            const items = normalize(relv);
            if (items.length === 0){
                const empty = document.createElement('div');
                empty.className = "text-sm text-zinc-400";
                empty.textContent = "No results.";
                grid.appendChild(empty);
                return;
            }
            items.forEach(m => grid.appendChild(tileFor(m)));
        })();

        // OTHERS: 17 initial, then +18 per click with 18th tile as button
        (function renderOthers(){
            const grid = document.getElementById('kp-grid-others');
            if (!grid) return;

            const items = normalize(kpTitle);
            let idx = 0;
            const INITIAL_BATCH = 17;
            const LOAD_MORE_BATCH = 18;

            function makeLoadMore(hasMore){
                const btn = document.createElement('button');
                btn.type = "button";
                btn.dataset.role = "load-more";
                btn.className = "rounded-2xl border border-amber-700/40 bg-amber-500/10 hover:bg-amber-500/20 transition p-0 overflow-hidden";
                btn.innerHTML = `
                  <div class="h-64 md:h-72 w-full flex flex-col items-center justify-center gap-2">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" class="opacity-80"><path d="M12 5v14m-7-7h14"/></svg>
                    <span class="text-amber-300 font-semibold tracking-wide">${hasMore ? 'Load more' : 'No more results'}</span>
                  </div>`;
                btn.disabled = !hasMore;
                if (hasMore) btn.addEventListener('click', renderBatch);
                return btn;
            }

            function renderBatch(){
                const last = grid.lastElementChild;
                if (last && last.dataset && last.dataset.role === 'load-more') grid.removeChild(last);

                const count = (idx === 0) ? INITIAL_BATCH : LOAD_MORE_BATCH;
                const end = Math.min(idx + count, items.length);

                for (; idx < end; idx++){
                    grid.appendChild(tileFor(items[idx]));
                }
                grid.appendChild(makeLoadMore(idx < items.length));
            }

            if (items.length) {
                renderBatch();
            } else {
                const empty = document.createElement('div');
                empty.className = "text-sm text-zinc-400";
                empty.textContent = "No results.";
                grid.appendChild(empty);
            }
        })();
    })();
</script>
</body>
</html>
